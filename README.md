# WhatsApp Bot с интеграцией Google Sheets

Этот проект представляет собой бота для WhatsApp, который интегрируется с Google Sheets для автоматизации бизнес-процессов. Бот может быть полезен для ресторанов, магазинов и других предприятий сферы услуг.

## Возможности

- Автоматическая обработка заказов через WhatsApp
- Хранение данных клиентов в Google Sheets
- Отслеживание статуса заказов
- Простой интерфейс для взаимодействия с клиентами

## Две версии бота

Проект поддерживает два варианта реализации WhatsApp API:

1. **WhatsApp Web.js** - для локального запуска (используется аутентификация через QR-код)
2. **WhatsApp Cloud API** - для размещения в облаке (например, на Render.com)

## Требования

- Node.js 14.x или выше
- Аккаунт Google для доступа к Google Sheets API
- Для WhatsApp Web.js: смартфон с установленным WhatsApp для сканирования QR-кода
- Для WhatsApp Cloud API: бизнес-аккаунт Meta и WhatsApp Business API

## Установка

1. Клонируйте репозиторий:

   ```
   git clone https://github.com/your-username/whatsapp-sheet-bot.git
   cd whatsapp-sheet-bot
   ```

2. Установите зависимости:

   ```
   npm install
   ```

3. Настройте Google Sheets API:

   - Перейдите в [Google Cloud Console](https://console.cloud.google.com/)
   - Создайте новый проект
   - Включите Google Sheets API
   - Создайте учетные данные (OAuth 2.0 для локального использования или Service Account для облачного)
   - Скачайте файл с учетными данными и сохраните его как `credentials.json` в корневой папке проекта

4. Создайте Google Таблицу:

   - Создайте новую таблицу в Google Sheets
   - Создайте два листа: "Клиенты" и "Заказы"
   - В листе "Клиенты" создайте заголовки: "Телефон", "Имя", "Компания"
   - В листе "Заказы" создайте заголовки: "Телефон", "Клиент", "Заказ", "Дата", "Статус"
   - Скопируйте ID таблицы из URL (часть между /d/ и /edit)

5. Настройте переменные окружения:

   - Создайте файл `.env` в корневой папке проекта
   - Для WhatsApp Web.js:
     ```
     SPREADSHEET_ID=ваш_идентификатор_таблицы
     PORT=3000
     ```
   - Для WhatsApp Cloud API:
     ```
     SPREADSHEET_ID=ваш_идентификатор_таблицы
     PORT=3000
     WHATSAPP_PHONE_ID=ваш_ID_телефона
     WHATSAPP_BUSINESS_ACCOUNT_ID=ваш_ID_бизнес_аккаунта
     WHATSAPP_TOKEN=ваш_токен_доступа
     WEBHOOK_VERIFY_TOKEN=ваш_токен_верификации
     ```

6. Для WhatsApp Web.js: получите токен авторизации Google API:
   - Запустите скрипт для получения токена:
     ```
     node getToken.js
     ```
   - Перейдите по ссылке, которая будет выведена в консоль
   - Авторизуйтесь в своем аккаунте Google
   - Скопируйте полученный код и вставьте его в консоль
   - Токен будет сохранен в файл `token.json`

## Запуск для локального использования (WhatsApp Web.js)

1. Переключитесь на ветку whatsapp-web-js или раскомментируйте соответствующий код в index.js

2. Запустите бота:

   ```
   node index.js
   ```

3. Отсканируйте QR-код в терминале с помощью WhatsApp на вашем телефоне:

   - Откройте WhatsApp
   - Нажмите на три точки в правом верхнем углу
   - Выберите "WhatsApp Web"
   - Отсканируйте QR-код

4. Бот готов к использованию!

## Запуск на Render.com (WhatsApp Cloud API)

1. Следуйте инструкциям в файле [render-setup.md](render-setup.md) для настройки и деплоя на Render.com.

2. Настройте вебхук для WhatsApp Cloud API, следуя официальной документации Meta.

3. Тестируйте бота, отправляя сообщения на ваш номер WhatsApp Business.

## Использование

Клиенты могут взаимодействовать с ботом, отправляя следующие команды:

- **привет** или **начать** - начало работы с ботом
- **заказ [детали заказа]** - оформление нового заказа
- **статус** - проверка статуса заказов
- **регистрация [Имя] [Компания]** - регистрация нового клиента
- **помощь** - получение справки по командам

## Структура проекта

- `index.js` - основной файл приложения
- `googleSheets.js` - функции для работы с Google Sheets API
- `botHandlers.js` - обработчики команд для WhatsApp Web.js
- `whatsappAPI.js` - функции для работы с WhatsApp Cloud API
- `cloudApiHandlers.js` - обработчики команд для WhatsApp Cloud API
- `getToken.js` - скрипт для получения токена авторизации Google API
- `render-setup.md` - инструкция по настройке на Render.com
- `credentials.json` - учетные данные Google API (не включены в репозиторий)
- `token.json` - токен доступа к Google API (генерируется автоматически)

## Дополнительная настройка

### Настройка автоматического запуска для локального использования

Для запуска бота в фоновом режиме можно использовать PM2:

```
npm install -g pm2
pm2 start index.js --name whatsapp-bot
pm2 save
pm2 startup
```

### Настройка шаблонов сообщений для WhatsApp Cloud API

Для отправки сообщений по инициативе бота (например, уведомлений):

1. Перейдите в Meta Business Suite → WhatsApp → Tools → Message Templates
2. Создайте и отправьте на проверку шаблоны сообщений
3. После одобрения используйте функцию `sendTemplateMessage` для их отправки

## Лицензия

MIT

## Автор

Ваше имя
